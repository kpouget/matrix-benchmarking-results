path_tpl: "{benchmark}/{flavor}/gpu={gpu_type}_{gpu_count}gpu_x_{pod_count}pod/run{flavor}_"

script_tpl: "exec/mlperf/run_{benchmark}.py"
remote_mode: false
stop_on_error: false

run:
  - dgx-quick

expe:
  dgx-quick:
    settings:
      flavor: 20211130
      run: 1, 2, 3
      execution_mode: fast
      benchmark: ssd
      threshold: 0.1
      cores: 8

      extra:
        - gpu_type=full, gpu_count=1, pod_count=1
        - gpu_type=full, gpu_count=2, pod_count=1
        - gpu_type=full, gpu_count=3, pod_count=1
        - gpu_type=full, gpu_count=4, pod_count=1
        - gpu_type=full, gpu_count=5, pod_count=1
        - gpu_type=full, gpu_count=6, pod_count=1
        - gpu_type=full, gpu_count=7, pod_count=1
        - gpu_type=full, gpu_count=8, pod_count=1

        - gpu_type=full, gpu_count=1, pod_count=1
        - gpu_type=full, gpu_count=1, pod_count=2
        - gpu_type=full, gpu_count=1, pod_count=3
        - gpu_type=full, gpu_count=1, pod_count=4
        - gpu_type=full, gpu_count=1, pod_count=5
        - gpu_type=full, gpu_count=1, pod_count=6
        - gpu_type=full, gpu_count=1, pod_count=7
        - gpu_type=full, gpu_count=1, pod_count=8

        - gpu_type=full, gpu_count=5, pod_count=2, opts=no-sync # 5 GPUs x 2 Pods

        - gpu_type=7g.40gb, gpu_count=5, pod_count=2, opts=no-sync # 5 GPUs x 2 Pods

        # test of the SINGL E strategy
        - mig_strategy=single, gpu_type=7g.40gb, gpu_count=1, pod_count=4 # 1 MIGs x 4 Pods (single strategy)
        # requesting more MIG GPUs than available
        - mig_strategy=single, gpu_type=7g.40gb, gpu_count=5, pod_count=2, opts=no-sync # 5 MIGs x 2 Pods (single strategy)

        # requesting different MIG GPU typse
        - gpu_type=2g.10gb,3g.20gb, gpu_count=1, pod_count=4, mig_label=all-balanced  # 3 MIG types x 1 MIG x 4 Pods

        - gpu_type=7g.40gb, gpu_count=1, pod_count=1
        - gpu_type=7g.40gb, gpu_count=2, pod_count=1
        - gpu_type=7g.40gb, gpu_count=3, pod_count=1
        - gpu_type=7g.40gb, gpu_count=4, pod_count=1
        - gpu_type=7g.40gb, gpu_count=5, pod_count=1
        - gpu_type=7g.40gb, gpu_count=6, pod_count=1
        - gpu_type=7g.40gb, gpu_count=7, pod_count=1
        - gpu_type=7g.40gb, gpu_count=8, pod_count=1

        - gpu_type=7g.40gb, gpu_count=1, pod_count=1
        - gpu_type=7g.40gb, gpu_count=1, pod_count=2
        - gpu_type=7g.40gb, gpu_count=1, pod_count=3
        - gpu_type=7g.40gb, gpu_count=1, pod_count=4
        - gpu_type=7g.40gb, gpu_count=1, pod_count=5
        - gpu_type=7g.40gb, gpu_count=1, pod_count=6
        - gpu_type=7g.40gb, gpu_count=1, pod_count=7
        - gpu_type=7g.40gb, gpu_count=1, pod_count=8

  dgx-test:
    settings:
      flavor: 20211119
      execution_mode: run
      benchmark: ssd
      threshold: 0.23
      cores: 8
      extra:
        - gpu_type=full, gpu_count=1, pod_count=1 # 1 GPU  x 1 Pod
        - gpu_type=full, gpu_count=4, pod_count=1 # 4 GPUs x 1 Pod
        - gpu_type=full, gpu_count=8, pod_count=1 # 8 GPU x 1 Pod
        - gpu_type=full, gpu_count=4, pod_count=2 # 4 GPU x 2 Pods
        - gpu_type=full, gpu_count=1, pod_count=8 # 1 GPU x 8 Pods

        # requesting more GPUs than available
        - gpu_type=full, gpu_count=5, pod_count=2, opts=no-sync # 5 GPUs x 2 Pods

        - gpu_type=7g.40gb, gpu_count=1, pod_count=1 # 1 MIG x 1 Pod

        - gpu_type=7g.40gb, gpu_count=4, pod_count=1 # 4 MIGs x 1 Pod
        - gpu_type=7g.40gb, gpu_count=8, pod_count=1 # 8 MIGs x 1 Pod

        - gpu_type=7g.40gb, gpu_count=4, pod_count=2 # 4 MIGs x 2 Pod
        - gpu_type=7g.40gb, gpu_count=1, pod_count=6 # 1 MIG x 6 Pods
        - gpu_type=7g.40gb, gpu_count=1, pod_count=7 # 1 MIG x 7 Pods

        # requesting more MIG GPUs than available
        - gpu_type=7g.40gb, gpu_count=5, pod_count=2, opts=no-sync # 5 MIGs x 2 Pods

        # requesting different MIG GPU typse
        - gpu_type=2g.10gb,3g.20gb, gpu_count=1, pod_count=4, mig_label=all-balanced  # 3 MIG types x 1 MIG x 4 Pods

        # test of the SINGLE strategy
        - mig_strategy=single, gpu_type=7g.40gb, gpu_count=1, pod_count=4 # 1 MIGs x 4 Pods (single strategy)
        # requesting more MIG GPUs than available
        - mig_strategy=single, gpu_type=7g.40gb, gpu_count=5, pod_count=2, opts=no-sync # 5 MIGs x 2 Pods (single strategy)

        #- 1g.5gb_56_1
        #- 1g.5gb_28_2
        #- 1g.5gb_14_4
        #- 1g.5gb_7_8
