apiVersion: kubeflow.org/v1
kind: MPIJob
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"kubeflow.org/v2beta1","kind":"MPIJob","metadata":{"annotations":{},"name":"osu-allreduce-2procs","namespace":"mpi-benchmark"},"spec":{"cleanPodPolicy":"Running","mpiReplicaSpecs":{"Launcher":{"replicas":1,"template":{"spec":{"containers":[{"command":["mpirun","--allow-run-as-root","-np","2","-bind-to","none","-map-by","slot","-mca","pml","ob1","-mca","btl","^openib","bash","-c","/opt/osu-micro-benchmarks/libexec/osu-micro-benchmarks/mpi/collective/osu_allreduce"],"image":"image-registry.openshift-image-registry.svc:5000/mpi-benchmark/mpi-bench:base","imagePullPolicy":"Always","name":"mpi-launcher"}],"initContainers":[{"command":["bash","-cx","[[ $(cat /etc/mpi/hostfile | wc -l) != 0 ]] \u0026\u0026 (date; echo 'Hostfile is ready'; cat /etc/mpi/hostfile) || (date; echo 'Hostfile not ready ...'; sleep 10; exit 1) \u0026\u0026 while read host; do while ! ssh $host echo $host ; do date; echo \"Pod $host is not up ...\"; sleep 10; done; date; echo \"Pod $host is ready\"; done \u003c\u003c\u003c \"$(cat /etc/mpi/hostfile)\""],"image":"image-registry.openshift-image-registry.svc:5000/mpi-benchmark/mpi-bench:base","name":"wait-hostfilename","volumeMounts":[{"mountPath":"/etc/mpi","name":"mpi-job-config"},{"mountPath":"/root/.ssh","name":"ssh-auth"}]}]}}},"Worker":{"replicas":2,"template":{"spec":{"containers":[{"image":"image-registry.openshift-image-registry.svc:5000/mpi-benchmark/mpi-bench:osu-bench","imagePullPolicy":"Always","name":"mpi-worker","securityContext":{"privileged":true}}]}}}},"slotsPerWorker":1}}
  creationTimestamp: "2022-01-19T16:47:06Z"
  generation: 1
  name: osu-allreduce-2procs
  namespace: mpi-benchmark
  resourceVersion: "137356"
  uid: 5669bf70-8d23-4ce8-91e8-3207294c4d29
spec:
  mpiReplicaSpecs:
    Launcher:
      replicas: 1
      template:
        spec:
          containers:
          - command:
            - mpirun
            - --allow-run-as-root
            - -np
            - "2"
            - -bind-to
            - none
            - -map-by
            - slot
            - -mca
            - pml
            - ob1
            - -mca
            - btl
            - ^openib
            - bash
            - -c
            - /opt/osu-micro-benchmarks/libexec/osu-micro-benchmarks/mpi/collective/osu_allreduce
            image: image-registry.openshift-image-registry.svc:5000/mpi-benchmark/mpi-bench:base
            imagePullPolicy: Always
            name: mpi-launcher
          initContainers:
          - command:
            - bash
            - -cx
            - '[[ $(cat /etc/mpi/hostfile | wc -l) != 0 ]] && (date; echo ''Hostfile
              is ready''; cat /etc/mpi/hostfile) || (date; echo ''Hostfile not ready
              ...''; sleep 10; exit 1) && while read host; do while ! ssh $host echo
              $host ; do date; echo "Pod $host is not up ..."; sleep 10; done; date;
              echo "Pod $host is ready"; done <<< "$(cat /etc/mpi/hostfile)"'
            image: image-registry.openshift-image-registry.svc:5000/mpi-benchmark/mpi-bench:base
            name: wait-hostfilename
            volumeMounts:
            - mountPath: /etc/mpi
              name: mpi-job-config
            - mountPath: /root/.ssh
              name: ssh-auth
    Worker:
      replicas: 2
      template:
        spec:
          containers:
          - image: image-registry.openshift-image-registry.svc:5000/mpi-benchmark/mpi-bench:osu-bench
            imagePullPolicy: Always
            name: mpi-worker
            securityContext:
              privileged: true
  slotsPerWorker: 1
status:
  completionTime: "2022-01-19T16:47:23Z"
  conditions:
  - lastTransitionTime: "2022-01-19T16:47:06Z"
    lastUpdateTime: "2022-01-19T16:47:06Z"
    message: MPIJob mpi-benchmark/osu-allreduce-2procs is created.
    reason: MPIJobCreated
    status: "True"
    type: Created
  - lastTransitionTime: "2022-01-19T16:47:20Z"
    lastUpdateTime: "2022-01-19T16:47:20Z"
    message: MPIJob mpi-benchmark/osu-allreduce-2procs is running.
    reason: MPIJobRunning
    status: "False"
    type: Running
  - lastTransitionTime: "2022-01-19T16:47:24Z"
    lastUpdateTime: "2022-01-19T16:47:24Z"
    message: MPIJob mpi-benchmark/osu-allreduce-2procs successfully completed.
    reason: MPIJobSucceeded
    status: "True"
    type: Succeeded
  replicaStatuses:
    Launcher:
      succeeded: 1
    Worker: {}
  startTime: "2022-01-19T16:47:06Z"
